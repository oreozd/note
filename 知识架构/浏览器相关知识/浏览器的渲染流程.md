从一个经典问题入手，在浏览器地址栏输入一个网址或者关键，到看到新的页面，这中间都发生了什么。

首先输入一个网址和关键字有些微的区别，浏览器判断出来你所输入的不是一个完整的url，会自动将他补全。如果是一个关键字，自动使用浏览器的默认搜索引擎去搜索，本质还是补全关键为一个完整的地址。

### 接着问题就统一为输入一个网址回车发生了什么？
首先在宏观层面会经历两个大的阶段
- 导航阶段
- 提交阶段

### 导航阶段
导航阶段的外在表现是，浏览器顶部的icon出现加载中的动画。页面仍然保持为原始页面。这个阶段浏览器底层进行的工作主要包含几个方面。

- 用户输入：如前面所说就是判断用户输入的内容，适当的补全，为下面的url请求做好准备
- url请求：
    - 有缓存：存在缓存，并且缓存未过期，直接使用缓存，不再发送网络请求。这里所说的缓存指的是强缓存（涉及到的概念是expries,cache-control）,具体细节会另外开一篇进行记录。
    - 无缓存：发起资源请求，会分为几个阶段
        - DNS解析：在解析DNS的时候，同样需要判断是否有可用缓存，注意这里的缓存一般指的是我们配置在电脑host文件中的映射关系。与👆所说的缓存不是一个概念。
        - 建立TCP链接，建立TLS链接，使用http或者https发起请求（这里的内容也值得展开讲一讲）
            - 返回状态码表示需要重定向(301永久重定向，302临时重定向)，需要根据返回的地址重新发起请求
            - 没有重定向，进入返回数据处理阶段
        - 准备渲染进程：同一个站点下的多个页面共用一个渲染进程
        - 提交文档：将上面接收到的资源从网络进程中传输给渲染进程处理，进行页面渲染的准备。
            - 提交文档消息由浏览器主进程发出
            - 网络进程和渲染进程之间建立传输通道，传输完毕之后，发送消息给浏览器主进程
            - 主进程收到确认提交消息之后，会进程一系列页面上的改动，（修改tab页标签，地址栏信息，前进后退信息，页面更新「注意通常所说的页面白屏就是出现在这个阶段」）

### 页面解析渲染阶段
渲染阶段宏观上看就是将，网络进程加载的html,css,js,图片，音频，视频等资源通过一定的规则组织起来，经过GPU进程的绘制，展示在用户面前。具体怎么组织，具体解析的步骤下面会详细说说。

按照时间顺序来说，这个阶段可以分为若干个子阶段，比如
- dom树创建
- 样式计算
- 布局计算
- 分层
- 绘制
- 分块
- 光栅化和合成

每个子阶段都有对应的输入和输出，接下来就从这个思路，拆解下这些子过程。

#### dom树创建
- 输入：一个html文件
- 过程中：通过html解析器。通过分词，转化为AST,然后再转化为具体的树结构
- 输出：一个和html对应的dom树对象，这个对象保存在内存中，可以使用js通过规定的api进行交互。这个地方也是可以展开说道说道的。

### 样式计算
- 输入：样式文件，样式文件可以有三种形式，行内样式，通过link标签导入的样式，通过<style>标签写在html head里的样式。
- 过程：
    - 将css文件或者代码进行转换，生成对应数量的stylesheet对象，该对象和dom对象一样可以通过js api进行修改。
    - 转换样式中的一些属性值，比如说百分数，一些相对单位。
    - 为dom树中的每个节点计算样式
- 输出：dom树上的节点都拥有了computedStyle属性，是对应节点对应的样式属性

### 布局计算
这个阶段主要是去确定节点的几何位置。具体如何计算，后续再深入研究
输入：一棵带有位置信息的dom树
过程：在个阶段会剔除掉一些不可见的元素，比如说设置了 display:none的元素
    - 剔除不可见元素
    - 位置计算
输出：一棵带有位置信息的dom树